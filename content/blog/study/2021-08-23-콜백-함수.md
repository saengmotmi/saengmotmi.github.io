---
title: 2021-08-23 콜백 함수
date: 2021-08-23 03:08:66
category: study
draft: false
---

### callback, 제어권을 위임하다

---

담백하게 콜백 함수(`callback function`)의 정의부터 한번 보고 가자.

> A callback function is **1) a function** **2) passed into another function as an argument**, which is then **3) invoked inside the outer function** to complete some kind of routine or action.
>
> \<Callback function\>, MDN

위 정의를 통해 알 수 있는 콜백 함수란,

- `함수`이다.
- `다른 함수에 인자`로서 넘겨진다.
- 어떤 루틴이나 액션을 완료하기 위해 `인자로서 넘겨진 함수 내부에서 실행`된다.

<br>

예컨대 다음과 같은 코드는 콜백 함수의 예시가 될 수 있다.

```js
function greeting(name) {
  alert('Hello ' + name)
}

function processUserInput(callback) {
  const name = prompt('Please enter your name.')
  callback(name)
}

processUserInput(greeting)
```

가장 먼저 `processUserInput` 함수가 실행되고 `callback`이라는 이름의 인자를 받는다. 인자로는 `greeting`이라는 함수가 전달 되고 있다. 이 함수는 `processUserInput` 내부로 전달되어 실행되며, 인자로 넘겨받은 값을 경고창에 띄운다.

여기서 `greeting`은 `함수`이자, `다른 함수에 인자`로서 넘겨지고 있으며, 특정 로직을 수행하기 위해 `넘겨진 함수 내부에서 실행`되고 있다. 따라서 콜백 함수로서의 조건을 갖추고 있다고 할 수 있다.

인자로 넘겨진 `greeting`은 콜백 함수, 콜백 함수를 인자로 받는 `processUserInput`은 `고차 함수(Higher-Order Function, HOF)`라고 부른다. 고차 함수는 외부로부터 함수를 전달 받아 자신의 일부로 합성하는 함수를 의미한다.

콜백 함수 개념의 핵심은 `제어권`의 전달에 있다. <코어 자바스크립트>에서는 콜백 함수를 다음과 같이 정의하고 있다.

> 콜백 함수는 **다른 코드(함수 또는 메서드)에게 인자로 넘겨줌으로써 그 제어권도 함께 위임**한 함수입니다. 콜백 함수를 위임받은 코드는 자체적인 내부 로직에 의해 이 콜백 함수를 **적절한 시점에 실행**할 것입니다.

`제어권을 위임한다`는 개념을 이해하는 것은 프로그래밍적인 측면에서 아주 중요한 갖는다. 이는 곧바로 `추상화`, `관심사의 분리`와 연결되기 때문이다. `Array.prototype.map`과 같은 함수 또한 고차 함수와 콜백 함수 관점에서 다시 생각해볼 수 있다.

```ts
const arr = [1, 2, 3, 4, 5]

// callback function
function addOne(num: number) {
  return num + 1
}

// higher-order function
const addOneArr = arr.map(addOne)
```

고차 함수와 콜백 함수를 합성하는 방법을 통해 기능의 관심사를 분리하고, 코드와 코드를 분리시켜 강결합되지 않는 형태로 유지할 수 있게 해준다.

예컨대 `map`은 '배열을 순회하면서 각각의 요소에 특정한 동작을 수행한 후 그 결과물을 새로운 배열로 리턴'하는 동작에 집중한다. 바꿔 말하면 그 동작에만 관심을 갖는 함수다.

한편 `addOne`이라는 함수는 '인자로 받은 number 값에 1를 더하여 리턴'하는 동작에만 관심을 갖는다.

만약 '배열을 순회하면서 각 요소에 특정한 동작을 수행한 뒤 그 결과를 새로운 배열로 리턴'하고 싶은데, '원래 요소를 제곱하는 동작'을 수행하고 싶다면 `map`의 인자로 `addOne`이 아니라 `square`라는 함수를 전달하면 된다는 뜻이다.

고차 함수와 콜백 함수의 협업에 관해 <모던 자바스크립트 Deep Dive>에서는 다음과 같이 언급하고 있다.

> 위 예제의 함수들은 반복하는 일은 변하지 않고 공통적으로 수행하지만 반복하면서 하는 일의 내용은 다르다. 즉, 함수의 일부분만이 다르기 때문에 매번 함수를 새롭게 정의해야 한다. 이 문제는 함수를 합성하는 것으로 해결할 수 있다. 함수의 변하지 않는 공통 로직은 미리 정의해 두고, 경우에 따라 변경되는 로직은 추상화해서 함수 외부에서 함수 내부로 전달하는 것이다.

<!-- > "이처럼 함수의 매개변수를 통해 다른 함수의 내부로 전달되는 함수를 콜백 함수(callback function)라고 하며, 매개변수를 통해 함수의 외부에서 콜백 함수를 전달 받은 함수를 고차 함수(Higher-Order Function, HOF)라고 한다." -->
<!--
> "중첩 함수가 외부 함수를 돕는 헬퍼 함수의 역할을 하는 것처럼 콜백 함수도 고차 함수에 전달되어 헬퍼 함수의 역할을 한다. 단, 중첩 함수는 고정되어 있어서 교체하기 곤란하지만 콜백 함수는 함수 외부에서 고차 함수 내부로 주입하기 때문에 자유롭게 교체할 수 있다는 장점이 있다. 즉, 고차 함수는 콜백 함수를 자신의 일부분으로 합성한다."

> "고차 함수는 매개변수를 통해 전달받은 콜백 함수의 호출 시점을 결정해서 호출한다. 다시 말해, 콜백 함수는 고차 함수에 의해 호출되며 이때 고차 함수는 필요에 따라 콜백 함수에 인수를 전달 할 수 있다." -->

<!-- 일급 함수 - 값으로서의 함수

"자바스크립트에서 객체는 일급 객체다. 여기서 '일급'은 값으로 다룰 수 있다는 의미로, 아래와 같은 조건을 만족해야 한다.

- 변수에 담을 수 있다.
- 함수나 메서드의 인자로 넘길 수 있다.
- 함수나 메서드에서 리턴할 수 있다.

자바스크립트에서 모든 값은 일급이다. 자바스크립트에서 모든 객체는 일급 객체이며 함수도 객체이자 일급 객체다. 그럼 일급 함수는 무엇일까? 보통 일급 함수는 아래와 같은 추가적인 조건을 더 만족한다.

- 아무 때나(런타임에서도) 선언이 가능하다.
- 익명으로 선언할 수 있다.
- 익명으로 선언한 함수도 함수나 메서드의 인자로 넘길 수 있다.

자바스크립트의 함수는 위 조건을 모두 만족하는 일급 함수다." - 함수형 자바스크립트 프로그래밍, 27

콜백 함수

보조 함수

"콜백 함수를 받아 자신이 해야 할 일을 모두 끝낸 후 결과를 되돌려 주는 함수도 고차 함수다. 보통은 비동기가 일어나는 상황에서 사용되며 콜백 함수를 통해 다시 원래 위치로 돌아오기 위해 사용되는 패턴이다. 콜백 패턴은 클로저 등과 함께 사용할 수 있는 매우 강력한 표현이자 비동기 프로그래밍에 있어 없어서는 안 될 매우 중요한 패턴이다. 콜백 패턴은 끝이 나면 컨텍스트를 다시 돌려주는 단순한 협업 로직을 가진다.
필자는 위 경우 만을 '콜백' 함수라고 부르는 것이 맞다고 생각한다. 컨텍스트를 다시 돌려주는 역할을 가졌기 때문에 callback이라고 함수 이름을 지은 것이다. 인자로 사용된 모든 함수를, 혹은 익명 함수가 넘겨지고 있는 모양을 보면 무조건 모두 '콜백' 함수라고 칭하는 경향이 있다. 콜백 함수는 반드시 익명 함수일 필요가 없을 뿐 아니라, 익명 함수가 넘어가는 모양을 가졌다고 반드시 콜백 함수는 아니다." - 함수형 자바스크립트 프로그래밍, 43

"button.click(function() {})과 같은 코드의 익명 함수도 콜백 함수라고 표현되는 것을 많이 보았지만, 이 익명 람수는 '이벤트 리스너'라고 칭하는 것이 적합하다. 함수가 고차 함수에서 쓰이는 역할의 이름으로 불러주면 된다."

"_.each([1, 2, 3], function() {})에서의 익명 함수는 callback이 이나리 iteratee이며 _.filter(users, function() {})에서의 익명 함수는 predicate다. callback은 종료가 되었을 때 단 한 번 실행되지만 iteratee나 predicate, listener 등은 종료될 때 실행되지 않으며 상황에 따라 여러 번 실행되기도 하고 각각 다른 역할을 한다."

"표현의 제약은 상상력에도 제약을 만든다. 모든 익명 함수는 콜백 함수가 아니다. 다양한 로직을 가진 각기 다른 고차 함수들을 만들 수 있고, 그 함수에서 사용될 보조 함수에게도 역할에 가장 맞는 이름이 있는 것이 좋다."

window.requestAnimationRequest()
Window.requestIdleCallback() -->

### 예상 면접 질문

---

-

<br/>

### 참고 자료

---

- 정재남, <코어 자바스크립트>
- 이웅모, <모던 자바스크립트 Deep Dive>
- 유인동, <함수형 자바스크립트 프로그래밍>
